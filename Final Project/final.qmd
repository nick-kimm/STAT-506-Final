---
title: "506-Final"
author: "Nick Kim"
format: html
---

## What makes a Championship Roster?

```{r}
library(nflreadr)
library(nflverse)
library(dbplyr)
```
Contract data
```{r}
nflreadr::dictionary_contracts
contracts<-as.data.frame(nflreadr::load_contracts())
contracts
```
Roster data per season
```{r}
nflreadr::dictionary_rosters
cur_season<-as.data.frame(nflreadr::load_rosters())
unique(cur_season$status)
```
```{r}
cur_season[cur_season$status=="RES"|cur_season$status=="ACT",]|>
  merge(x=_,contracts[,c(10,16)],by="gsis_id")|>
  _[,c(1:4,8,37)]
```
```{r}
test<-contracts[contracts$gsis_id == "00-0023459" & !is.na(contracts$gsis_id), c(1,3,5:6,10)]
test
```
```{r}
b<-test[
  test$year_signed <= 2021 &  # Contract signed before or in the target year
  (test$year_signed + test$years - 1) >= 2021,  # Contract still valid in the target year
]
b
b[b$year_signed==max(b$year_signed),]
```

```{r}
library(dplyr)
target_yr = 2024
fil<-contracts[
  contracts$year_signed <= target_yr & 
    (contracts$years + contracts$year_signed - 1)>= target_yr,
]

fil<-fil %>% 
  group_by(gsis_id) %>% 
  filter(year_signed == max(year_signed)) %>% 
  ungroup()

fil
```
```{r}
test<-cur_season[cur_season$status=="RES"|cur_season$status=="ACT",]|>
  merge(x=_,fil[,c(10,16)],by="gsis_id")|>
  _[,c(1:4,8,37)]

test
```
```{r}
#fil[fil$gsis_id == "00-0037526"|fil$gsis_id =="00-0034902" & !is.na(fil$gsis_id), ]
test[test$team == "ARI",]
#sum(test[test$team == "NYJ",6])-(.006+.005+.006+.003)

```


